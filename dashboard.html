<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script src="components-inline.js"></script>
  <script src="grid.js"></script>
  
  <style>
    /* ======================================================== */
    /* ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    /* ======================================================== */
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --success: #16a34a;
      --success-hover: #15803d;
      --danger: #dc2626;
      --danger-hover: #b91c1c;
      --warning: #f59e0b;
      --info: #0ea5e9;
      --gray: #6b7280;
      --light-gray: #f3f4f6;
      --white: #ffffff;
      --dark: #1f2937;
      --background: #f5f7fa; 
      --card-background: #ffffff;
      --text-color: var(--dark);
      --secondary-text: var(--gray);
      --border-color: #e5e7eb;
      --sidebar-width: 250px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans Bengali', sans-serif;
    }

    body {
      background-color: var(--background);
      color: var(--text-color);
      overflow-x: hidden;
    }

    /* ======================================================== */
    /* ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    /* ======================================================== */
    .admin-container {
      display: flex;
      min-height: 100vh;
      padding-top: 60px;
    }

    #sidebar-container {
      flex-shrink: 0;
    }

    .admin-main {
      flex: 1;
      padding: 20px;
      background-color: var(--background);
      min-height: calc(100vh - 60px);
      overflow-x: hidden;
    }

    /* ======================================================== */
    /* ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    /* ======================================================== */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .card {
      background-color: var(--white);
      border-radius: 10px;
      padding: 18px 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      position: relative;
      overflow: hidden;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .card h3 {
      color: var(--dark);
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: 600;
      line-height: 1.3;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .card p {
      font-size: 28px;
      font-weight: 700;
      color: var(--dark);
      margin: 0;
    }
    
    /* ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ */
    .called-apps p { color: var(--success); }
    .not-called-apps p { color: var(--danger); }
    .token-given-apps p { color: var(--warning); }
    .token-not-given-apps p { color: var(--primary); }
    .thursday p { color: var(--primary); }
    .friday p { color: #8b5cf6; }
    .total-appointments p { color: #0ea5e9; }
    .pending p { color: #f59e0b; }
    .total p { color: #6366f1; }
    .available p { color: var(--success); }
    .new-call p { color: #10b981; }
    .old-call p { color: #8b5cf6; }

    .grid-no-selection {
        grid-column: 1 / -1;
        text-align: center;
        padding: 20px;
        color: #6b7280;
        font-style: italic;
      }

  /* ======================================================== */
/* ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ - management.html ‡¶è‡¶∞ ‡¶Æ‡¶§‡ßã */
/* ======================================================== */
.filter-section {
  background-color: var(--white);
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  margin-bottom: 20px;
}

/* ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶≠‡¶ø‡¶â (1025px+): ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂‡ßá */
@media (min-width: 1025px) {
  .admin-table-header {
    display: flex;
    justify-content: flex-start; /* ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: space-between ‡¶•‡ßá‡¶ï‡ßá flex-start */
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: nowrap;
    gap: 15px; /* ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡¶°‡¶º‡¶æ‡¶®‡ßã */
  }
  
  .admin-table-header h2 {
    font-size: 18px;
    color: var(--dark);
    margin: 0;
    white-space: nowrap;
    flex-shrink: 0;
    min-width: 160px;
    order: 1; /* ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ */
  }
  
  .header-actions {
    display: flex;
    align-items: center;
    gap: 10px; /* ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡¶°‡¶º‡¶æ‡¶®‡ßã */
    flex: 1;
    flex-wrap: nowrap;
    justify-content: flex-start; /* ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: flex-end ‡¶•‡ßá‡¶ï‡ßá flex-start */
    order: 2; /* ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º‡¶§‡ßá ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞+‡¶∏‡¶æ‡¶∞‡ßç‡¶ö */
  }
  
  .filter-group {
    display: flex;
    gap: 8px; /* ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡¶°‡¶º‡¶æ‡¶®‡ßã */
    flex-wrap: nowrap;
    flex: none; /* ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: flex: 1 ‡¶•‡ßá‡¶ï‡ßá flex: none */
  }
  
  .filter-group select {
    padding: 7px 10px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 13px;
    background-color: var(--white);
    color: var(--dark);
    cursor: pointer;
    min-width: 110px;
    max-width: 120px;
    height: 36px;
    flex-shrink: 0;
  }
  
  .search-box {
    position: relative;
    width: 180px;
    flex-shrink: 0;
    margin-left: 10px; /* ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßç‡¶™‡ßá‡¶∏ */
  }
  
  .search-box input {
    width: 100%;
    padding: 7px 10px 7px 32px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 13px;
    height: 36px;
    box-sizing: border-box;
  }
  
  .add-btn {
    padding: 7px 14px;
    background-color: var(--success);
    color: var(--white);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s;
    white-space: nowrap;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 5px;
    flex-shrink: 0;
    height: 36px;
    margin-left: 10px; /* ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßç‡¶™‡ßá‡¶∏ */
  }
  
  /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
  .mobile-filter-row-1,
  .mobile-filter-row-2,
  .mobile-add-btn {
    display: none !important;
  }
  
  .search-icon {
    width: 14px;
    height: 14px;
    left: 10px;
  }
}

/* ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡¶≤‡ßá‡¶ü ‡¶≠‡¶ø‡¶â (769px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
  .admin-table-header {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }
  
  .admin-table-header h2 {
    text-align: center;
    width: 100%;
    margin-bottom: 10px;
    font-size: 16px;
  }
  
  .header-actions {
    width: 100%;
    flex-direction: column;
    gap: 10px;
  }
  
  .filter-group {
    width: 100%;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .filter-group select {
    flex: 1 1 calc(33.333% - 6px);
    min-width: 110px;
    max-width: 160px;
    padding: 8px 10px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 13px;
    background-color: var(--white);
    color: var(--dark);
    cursor: pointer;
    height: 36px;
  }
  
  .search-box {
    width: 100%;
    position: relative;
  }
  
  .search-box input {
    width: 100%;
    padding: 8px 10px 8px 32px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 13px;
    height: 36px;
    box-sizing: border-box;
  }
  
  .add-btn {
    width: 100%;
    padding: 9px;
    background-color: var(--success);
    color: var(--white);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    height: 36px;
  }
  
  /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
  .mobile-filter-row-1,
  .mobile-filter-row-2,
  .mobile-add-btn {
    display: none !important;
  }
  
  .search-icon {
    width: 14px;
    height: 14px;
    left: 10px;
  }
}

/* ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡¶≤‡ßá‡¶ü ‡¶≠‡¶ø‡¶â (769px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
  .admin-table-header {
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }
  
  .admin-table-header h2 {
    text-align: center;
    width: 100%;
    margin-bottom: 8px;
    font-size: 16px;
  }
  
  .header-actions {
    width: 100%;
    flex-direction: column;
    gap: 8px;
  }
  
  .filter-group {
    width: 100%;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .filter-group select {
    flex: 1 1 calc(33.333% - 4px);
    min-width: 100px;
    max-width: 140px;
    padding: 6px 8px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 12px;
    background-color: var(--white);
    color: var(--dark);
    cursor: pointer;
    height: 34px;
  }
  
  .search-box {
    width: 100%;
    position: relative;
  }
  
  .search-box input {
    width: 100%;
    padding: 6px 8px 6px 30px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 12px;
    height: 34px;
    box-sizing: border-box;
  }
  
  .add-btn {
    width: 100%;
    padding: 8px;
    background-color: var(--success);
    color: var(--white);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s;
    font-size: 12px;
    display: flex !important; /* important ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® */
    align-items: center;
    justify-content: center;
    gap: 4px;
    height: 34px;
  }
  
  /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
  .mobile-filter-row-1,
  .mobile-filter-row-2,
  .mobile-add-btn {
    display: none !important;
  }
  
  /* ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡¶≤‡ßá‡¶ü ‡¶≠‡¶ø‡¶â ‡¶∂‡ßã */
  .header-actions {
    display: flex !important;
  }
  
  .search-icon {
    width: 14px;
    height: 14px;
    left: 10px;
  }
}

/* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â (768px ‡¶®‡¶ø‡¶ö‡ßá): ‡ß™ ‡¶≤‡¶æ‡¶á‡¶® */
@media (max-width: 768px) {
  /* ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶≠‡¶ø‡¶â ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
  .header-actions {
    display: none !important;
  }
  
  .admin-table-header {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 15px;
    width: 100%;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ßß: ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü (‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá) */
  .admin-table-header h2 {
    font-size: 16px;
    color: var(--dark);
    text-align: center;
    margin: 0;
    width: 100%;
    order: 1;
    display: block !important;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß®: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ßß, ‡ß®, ‡ß© - 3‡¶ü‡¶ø ‡¶è‡¶ï ‡¶≤‡¶æ‡¶á‡¶®‡ßá */
  .mobile-filter-row-1 {
    display: flex !important;
    flex-direction: column;
    gap: 8px;
    width: 100%;
    order: 2;
  }
  
  .mobile-filter-row-1 .filter-group {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    width: 100%;
  }
  
  .mobile-filter-row-1 .filter-group select {
    width: 100%;
    font-size: 13px;
    padding: 8px 10px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    background-color: var(--white);
    color: var(--dark);
    cursor: pointer;
    display: block !important;
    height: 38px;
    box-sizing: border-box;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß©: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ß™, ‡ß´, ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö - 3‡¶ü‡¶ø ‡¶è‡¶ï ‡¶≤‡¶æ‡¶á‡¶®‡ßá */
  .mobile-filter-row-2 {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    width: 100%;
    order: 3;
    align-items: stretch;
  }
  
  .mobile-filter-row-2 .filter-group {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    grid-column: span 2;
  }
  
  .mobile-filter-row-2 .filter-group select {
    width: 100%;
    font-size: 13px;
    padding: 8px 10px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    background-color: var(--white);
    color: var(--dark);
    cursor: pointer;
    display: block !important;
    height: 38px;
    box-sizing: border-box;
  }
  
  .mobile-search-box {
    position: relative;
    display: block !important;
    grid-column: span 1;
  }
  
  .mobile-search-box input {
    width: 100%;
    padding: 8px 10px 8px 35px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-family: 'Noto Sans Bengali', sans-serif;
    font-size: 13px;
    display: block !important;
    height: 38px;
    box-sizing: border-box;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß™: ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ü‡¶® */
  .mobile-add-btn {
    width: 100%;
    padding: 10px;
    background-color: var(--success);
    color: var(--white);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s;
    font-size: 14px;
    display: flex !important;
    align-items: center;
    justify-content: center;
    gap: 6px;
    height: 40px;
    order: 4;
    margin-top: 5px;
  }
  
  /* ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
  .filter-group:not(.mobile-filter-row-1 .filter-group):not(.mobile-filter-row-2 .filter-group),
  .search-box:not(.mobile-search-box),
  .add-btn:not(.mobile-add-btn) {
    display: none !important;
  }
}

/* ‡¶ï‡¶Æ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∏ */
.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  color: var(--gray);
}

.filter-group select:focus,
.mobile-filter-row-1 .filter-group select:focus,
.mobile-filter-row-2 .filter-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.search-box input:focus,
.mobile-search-box input:focus {
  outline: none;
  border-color: var(--primary);
}

.add-btn:hover,
.mobile-add-btn:hover {
  background-color: var(--success-hover);
}

.stats-info {
  background-color: #eff6ff;
  color: var(--primary);
  padding: 12px 20px;
  border-radius: 8px;
  text-align: center;
  font-weight: 600;
  font-size: 14px;
  margin-top: 15px;
}

/* ‡¶õ‡ßã‡¶ü ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (480px ‡¶®‡¶ø‡¶ö‡ßá) */
@media (max-width: 480px) {
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß®: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ßß, ‡ß®, ‡ß© */
  .mobile-filter-row-1 .filter-group {
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
  }
  
  .mobile-filter-row-1 .filter-group select {
    font-size: 12px;
    padding: 7px 8px;
    height: 36px;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß©: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ß™, ‡ß´, ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö */
  .mobile-filter-row-2 {
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
  }
  
  .mobile-filter-row-2 .filter-group {
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
    grid-column: span 2;
  }
  
  .mobile-filter-row-2 .filter-group select {
    font-size: 12px;
    padding: 7px 8px;
    height: 36px;
  }
  
  .mobile-search-box input {
    font-size: 12px;
    padding: 7px 8px 7px 30px;
    height: 36px;
  }
  
  .mobile-add-btn {
    font-size: 13px;
    padding: 8px;
    height: 38px;
    margin-top: 6px;
  }
}

/* ‡¶ñ‡ßÅ‡¶¨ ‡¶õ‡ßã‡¶ü ‡¶´‡ßã‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø (360px ‡¶®‡¶ø‡¶ö‡ßá) */
@media (max-width: 360px) {
  .filter-section {
    padding: 15px;
  }
  
  .admin-table-header h2 {
    font-size: 15px;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß®: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ßß, ‡ß®, ‡ß© */
  .mobile-filter-row-1 .filter-group {
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
  }
  
  /* ‡¶≤‡¶æ‡¶á‡¶® ‡ß©: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ß™, ‡ß´, ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö */
  .mobile-filter-row-2 {
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
  }
  
  .mobile-filter-row-2 .filter-group {
    grid-template-columns: repeat(2, 1fr);
    gap: 5px;
    grid-column: span 2;
  }
  
  .mobile-filter-row-1 .filter-group select,
  .mobile-filter-row-2 .filter-group select {
    font-size: 11px;
    padding: 6px 7px;
    height: 34px;
  }
  
  .mobile-search-box input {
    font-size: 11px;
    padding: 6px 7px 6px 28px;
    height: 34px;
  }
  
  .mobile-add-btn {
    font-size: 12px;
    padding: 7px;
    height: 36px;
  }
}
    
    .stats-info {
      background-color: #eff6ff;
      color: var(--primary);
      padding: 12px 20px;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      margin-top: 15px;
    }

    /* ======================================================== */
    /* ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    /* ======================================================== */
    .table-container {
      background-color: var(--card-background);
      padding: 0;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      margin-top: 20px;
    }
    
    .table-wrapper {
      overflow-x: auto;
      max-height: calc(100vh - 300px);
      min-height: 400px;
    }
    
    .table-wrapper::-webkit-scrollbar {
      height: 8px;
      width: 8px;
    }
    
    .table-wrapper::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    .table-wrapper::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    
    .table-wrapper::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
    
    #appointmentsTable {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px;
    }
    
    #appointmentsTable th {
      background-color: var(--light-gray);
      padding: 14px 16px;
      text-align: left;
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
      white-space: nowrap;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 2px solid var(--border-color);
    }
    
    #appointmentsTable td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-color);
      font-size: 13px;
      vertical-align: middle;
    }
    
    #appointmentsTable tr:hover {
      background-color: rgba(243, 244, 246, 0.5);
    }
    
    #appointmentsTable tr:last-child td {
      border-bottom: none;
    }
    
    /* ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú */
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      min-width: 100px;
      text-align: center;
    }
    
    .status-called {
      background-color: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    
    .status-not-called {
      background-color: #fef3c7;
      color: #92400e;
      border: 1px solid #fde68a;
    }
    
    .status-token-given {
      background-color: #dbeafe;
      color: #1e40af;
      border: 1px solid #bfdbfe;
    }
    
    .status-token-not-given {
      background-color: #f3e8ff;
      color: #5b21b6;
      border: 1px solid #e9d5ff;
    }
    
    /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® */
    .action-btn {
      padding: 6px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-width: 90px;
      white-space: nowrap;
    }
    
    .btn-call {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-call:hover {
      background-color: var(--primary-hover);
    }
    
    .btn-call-undo {
      background-color: var(--danger);
      color: white;
    }
    
    .btn-call-undo:hover {
      background-color: var(--danger-hover);
    }
    
    .btn-token {
      background-color: var(--warning);
      color: white;
    }
    
    .btn-token:hover {
      background-color: #eab308;
    }
    
    .btn-token-undo {
      background-color: var(--info);
      color: white;
    }
    
    .btn-token-undo:hover {
      background-color: #0284c7;
    }
    
    /* ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú */
    #loadingMessage {
      text-align: center;
      padding: 40px;
      color: var(--gray);
      font-size: 16px;
      display: none;
    }
    
    #loadingMessage.show {
      display: block;
    }

    /* ======================================================== */
    /* ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ */
    /* ======================================================== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: var(--white);
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      max-height: 85vh;
      overflow-y: auto;
    }
    
    .close-btn {
      position: absolute;
      top: 20px;
      right: 25px;
      background: none;
      border: none;
      font-size: 28px;
      color: var(--gray);
      cursor: pointer;
      line-height: 1;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close-btn:hover {
      color: var(--dark);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-family: 'Noto Sans Bengali', sans-serif;
      font-size: 14px;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .age-inputs {
      display: flex;
      gap: 10px;
    }
    
    .age-inputs > div {
      flex: 1;
    }
    
    /* ‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
    .serial-types {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }
    
    .serial-type-card {
      flex: 1;
      padding: 12px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .serial-type-card:hover {
      border-color: var(--primary);
      background-color: rgba(37, 99, 235, 0.05);
    }
    
    .serial-type-card.selected {
      border-color: var(--primary);
      background-color: rgba(37, 99, 235, 0.1);
    }
    
    .serial-type-card h4 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: var(--dark);
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }
    
    .form-actions button {
      flex: 1;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: background-color 0.2s ease;
      border: none;
    }
    
    .submit-btn {
      background-color: var(--primary);
      color: white;
    }
    
    .submit-btn:hover {
      background-color: var(--primary-hover);
    }
    
    .cancel-btn-modal {
      background-color: var(--gray);
      color: white;
    }
    
    .cancel-btn-modal:hover {
      background-color: #4b5563;
    }

    /* ======================================================== */
    /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡¶∏‡¶ø‡¶≠ */
    /* ======================================================== */
    @media (max-width: 768px) {
      .admin-container {
        padding-top: 60px;
      }
      
      .admin-main {
        padding: 15px;
        min-height: calc(100vh - 60px);
      }
      
      .dashboard-cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      .card {
        padding: 15px 10px;
      }
      
      .card h3 {
        font-size: 13px;
        height: 36px;
      }
      
      .card p {
        font-size: 22px;
      }
    
      .filter-section {
        padding: 15px;
      }
      
      .table-wrapper {
        max-height: calc(100vh - 100px);
      }
      
      .modal-content {
        margin: 10px;
        width: calc(100% - 20px);
        padding: 20px 15px;
      }
      
      .age-inputs {
        flex-direction: column;
        gap: 8px;
      }
      
      /* ‡¶õ‡ßã‡¶ü ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
      @media (max-width: 480px) {
        .mobile-filter-row-1 .filter-group select {
          flex: 1 1 100%;
          margin-bottom: 5px;
          font-size: 12px;
          padding: 7px 8px;
        }
        
        .mobile-filter-row-2 .filter-group select {
          flex: 1 1 100%;
          margin-bottom: 5px;
          font-size: 12px;
          padding: 7px 8px;
        }
        
        .mobile-search-box input {
          font-size: 12px;
          padding: 7px 8px 7px 30px;
        }
        
        .mobile-add-btn {
          font-size: 13px;
          padding: 8px;
        }
      }
    }
    
    @media (max-width: 480px) {
      .admin-main {
        padding: 12px;
      }
      
      .dashboard-cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      
      .card {
        padding: 12px 8px;
      }
      
      .card h3 {
        font-size: 11px;
        height: 30px;
      }
      
      .card p {
        font-size: 18px;
      }
      
      .status-badge {
        min-width: 80px;
        font-size: 11px;
        padding: 3px 8px;
      }
      
      .action-btn {
        min-width: 75px;
        padding: 5px 10px;
        font-size: 12px;
      }
      
      #appointmentsTable th,
      #appointmentsTable td {
        padding: 10px 8px;
        font-size: 12px;
      }
      
      .stats-info {
        padding: 10px 15px;
        font-size: 13px;
      }
    }
    
    @media (max-width: 360px) {
      .dashboard-cards {
        grid-template-columns: 1fr;
      }
    }

    /* ======================================================== */
    /* ‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶∏‡ßç‡¶ï‡ßá‡¶™ ‡¶Æ‡ßã‡¶° */
    /* ======================================================== */
    @media (max-height: 600px) and (orientation: landscape) {
      .dashboard-cards {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }
      
      .card h3 {
        font-size: 11px;
        height: 28px;
      }
      
      .card p {
        font-size: 18px;
      }
      
      .table-wrapper {
        max-height: 300px;
      }
    }
  </style>
</head>
<body data-auto-load-components="true"> 

  <div id="header-container"></div> 

  <div class="admin-container">
    <div id="sidebar-container"></div> 
    
    <main class="admin-main">
      <h2 style="margin-bottom: 20px; color: var(--dark); font-size: 22px;">‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç</h2> 
      
      <!-- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ï‡¶æ‡¶∞‡ßç‡¶° -->
      <div class="dashboard-cards"> 
        <div class="card thursday"> <h3>‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶è‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3> <p id="thursdayAppointments">‡ß¶</p> </div>
        <div class="card friday"> <h3>‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶è‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3> <p id="fridayAppointments">‡ß¶</p> </div>
        <div class="card total-appointments"> <h3>‡¶Æ‡ßã‡¶ü ‡¶è‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3> <p id="totalAppointments">‡ß¶</p> </div>
        <div class="card pending"> <h3>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤</h3> <p id="pendingSerials">‡ß¶</p> </div>
        <div class="card total"> <h3>‡¶Æ‡ßã‡¶ü ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶≤‡¶ü</h3> <p id="totalSerials">‡ß¶</p> </div>
        <div class="card available"> <h3>‡¶Æ‡ßã‡¶ü ‡¶è‡¶≠‡ßá‡¶á‡¶≤‡ßá‡¶¨‡¶≤</h3> <p id="availableSerials">‡ß¶</p> </div>
        <div class="card called-apps"> <h3>‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</h3> <p id="called-count">‡ß¶</p> </div> 
        <div class="card not-called-apps"> <h3>‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º ‡¶®‡¶ø</h3> <p id="not-called-count">‡ß¶</p> </div> 
        <div class="card token-given-apps"> <h3>‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</h3> <p id="token-given-count">‡ß¶</p> </div> 
        <div class="card token-not-given-apps"> <h3>‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º ‡¶®‡¶ø</h3> <p id="token-not-given-count">‡ß¶</p> </div>
        <div class="card new-call"> <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶≤</h3> <p id="newPatientLastCall">‡ß¶</p> </div>
        <div class="card old-call"> <h3>‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶≤</h3> <p id="oldPatientLastCall">‡ß¶</p> </div>
      </div>
      
      <!-- ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® - management.html ‡¶è‡¶∞ ‡¶Æ‡¶§‡ßã -->
      <div class="filter-section">
        <div class="admin-table-header">
          <h2>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
          
          <!-- ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶≠‡¶ø‡¶â (1025px+): ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶è‡¶ï ‡¶≤‡¶æ‡¶á‡¶®‡ßá -->
          <div class="header-actions">
            <div class="filter-group">
              <select id="dayFilterSerial">
                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶¶‡¶ø‡¶®</option>
                <option value="Thursday">‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞</option>
                <option value="Friday">‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞</option>
              </select>
              <select id="typeFilterSerial">
                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶ß‡¶∞‡¶®</option>
                <option value="new">‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ</option>
                <option value="old">‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ</option>
              </select>
              <select id="timeFilterSerial">
                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º</option>
              </select>
              <select id="call-status-filter">
                <option value="all">‡¶ï‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</option>
                <option value="called">‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
                <option value="not_called">‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</option>
              </select>
              <select id="token-status-filter">
                <option value="all">‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</option>
                <option value="given">‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
                <option value="not_given">‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</option>
              </select>
            </div>
            <div class="search-box">
              <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
              </svg>
              <input type="text" id="searchInput" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶´‡ßã‡¶® ‡¶¨‡¶æ ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." />
            </div>
            <button class="add-btn" id="openAddSerialModalBtn">
              <i class="fas fa-plus-circle"></i>
              ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
          </div>
          
          <!-- ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â (768px ‡¶®‡¶ø‡¶ö‡ßá): ‡ß™ ‡¶≤‡¶æ‡¶á‡¶® -->
          <!-- ‡¶≤‡¶æ‡¶á‡¶® ‡ß®: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ßß, ‡ß®, ‡ß© -->
          <div class="mobile-filter-row-1">
            <div class="filter-group">
              <select id="dayFilterSerialMobile">
                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶¶‡¶ø‡¶®</option>
                <option value="Thursday">‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞</option>
                <option value="Friday">‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞</option>
              </select>
              <select id="typeFilterSerialMobile">
                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶ß‡¶∞‡¶®</option>
                <option value="new">‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ</option>
                <option value="old">‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ</option>
              </select>
              <select id="timeFilterSerialMobile">
                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º</option>
              </select>
            </div>
          </div>
          
          <!-- ‡¶≤‡¶æ‡¶á‡¶® ‡ß©: ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡ß™, ‡ß´, ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö -->
          <div class="mobile-filter-row-2">
            <div class="filter-group">
              <select id="call-status-filter-mobile">
                <option value="all">‡¶ï‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</option>
                <option value="called">‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
                <option value="not_called">‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</option>
              </select>
              <select id="token-status-filter-mobile">
                <option value="all">‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</option>
                <option value="given">‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
                <option value="not_given">‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</option>
              </select>
            </div>
            <div class="search-box mobile-search-box">
              <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
              </svg>
              <input type="text" id="searchInputMobile" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶´‡ßã‡¶® ‡¶¨‡¶æ ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤..." />
            </div>
          </div>
          
          <!-- ‡¶≤‡¶æ‡¶á‡¶® ‡ß™: ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ü‡¶® -->
          <button class="add-btn mobile-add-btn" id="openAddSerialModalBtnMobile">
            <i class="fas fa-plus-circle"></i>
            ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
          </button>
        </div>
        
        <!-- ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ -->
        <div id="statusMessage" class="stats-info">
          ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç: <span id="filteredCount">‡ß¶</span> ‡¶ü‡¶ø‡•§ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§: <span id="displayedCount">‡ß¶</span> ‡¶ü‡¶ø‡•§
        </div>
      </div>
      
      <!-- ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü -->
      <div class="table-container">
        <div class="table-wrapper">
          <table id="appointmentsTable"> 
            <thead> 
              <tr>
                <th>‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤</th>
                <th>‡¶ï‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                <th>‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                <th>‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                <th>‡¶¨‡¶Ø‡¶º‡¶∏</th>
                <th>‡¶´‡ßã‡¶®</th>
                <th>‡¶¶‡¶ø‡¶®/‡¶∏‡¶Æ‡¶Ø‡¶º</th>
                <th>‡¶ß‡¶∞‡¶®</th> 
                <th>‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                <th>‡¶ï‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                <th>‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
              </tr>
            </thead> 
            <tbody id="appointmentsBody"></tbody> 
          </table>
        </div>
        <p id="loadingMessage" class="loading-message">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
      </div>
    </main>
  </div>

  <div id="footer-container"></div>
  
  <!-- ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ -->
  <div class="modal" id="quickSerialModal">
    <div class="modal-content">
      <h2 style="margin-bottom: 20px; color: var(--dark);">‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <button class="close-btn" id="closeQuickModal">&times;</button>
      
      <form id="quickSerialForm">
        <div class="form-group">
          <label for="quickDay">‡¶¶‡¶ø‡¶®</label>
          <select id="quickDay" required>
            <option value="">‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
            <option value="Thursday">‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞</option>
            <option value="Friday">‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="quickTime">‡¶∏‡¶Æ‡¶Ø‡¶º</label>
          <select id="quickTime" required>
            <option value="">‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
          </select>
        </div>
        
        <!-- ‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶ß‡¶∞‡¶® -->
        <div class="form-group">
          <label>‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶ß‡¶∞‡¶®</label>
          <div class="serial-types">
            <div class="serial-type-card selected" data-type="new">
              <h4>‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ</h4>
            </div>
            <div class="serial-type-card" data-type="old">
              <h4>‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ</h4>
            </div>
          </div>
          <input type="hidden" id="selectedPatientType" value="new">
        </div>
        
        <!-- ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ó‡ßç‡¶∞‡¶ø‡¶° (grid.js ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶ø‡¶§ ‡¶π‡¶¨‡ßá) -->
        <div class="form-group">
          <label>‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
          <div class="serial-grid" id="serialGrid">
            <!-- grid.js ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶°‡¶æ‡¶Ø‡¶º‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
          </div>
          <input type="hidden" id="serialInput" value="">
          <small style="color: var(--gray); font-size: 12px; display: block; margin-top: 5px;">
            ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
          </small>
        </div>
        
        <div class="form-group">
          <label for="quickName">‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
          <input type="text" id="quickName" required placeholder="‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
        </div>
        
        <div class="form-group">
          <label for="quickAge">‡¶¨‡¶Ø‡¶º‡¶∏</label>
          <div class="age-inputs">
            <div>
              <input type="number" id="quickAgeYears" min="0" max="120" placeholder="‡¶¨‡¶õ‡¶∞">
            </div>
            <div>
              <input type="number" id="quickAgeMonths" min="0" max="11" placeholder="‡¶Æ‡¶æ‡¶∏">
            </div>
            <div>
              <input type="number" id="quickAgeDays" min="0" max="30" placeholder="‡¶¶‡¶ø‡¶®">
            </div>
          </div>
          <small style="color: var(--gray); font-size: 12px; display: block; margin-top: 5px;">
            ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®
          </small>
        </div>
        
        <div class="form-group">
          <label for="quickPhone">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
          <input type="text" id="quickPhone" placeholder="01XXXXXXXXX">
        </div>
        
        <div class="form-actions">
          <button type="button" class="cancel-btn-modal" id="cancelQuickModal">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
          <button type="submit" class="submit-btn" id="submitQuickBtn">‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
      </form>
    </div>
  </div>
  
  <script>

    // =======================================================
// AUTHENTICATION CHECK - FIXED
// =======================================================
function checkAuthentication() {
  const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
  const loginTime = sessionStorage.getItem('loginTime');
  
  // ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó‡¶ø‡¶Ç
  console.log('Auth check - isLoggedIn:', isLoggedIn, 'loginTime:', loginTime);
  
  if (!isLoggedIn || isLoggedIn !== 'true') {
    console.log('Not logged in, redirecting to login');
    alert('Please login first!!');
    window.location.href = '/login';
    return false;
  }
  
  const currentTime = new Date().getTime();
  const sessionDuration = 2 * 60 * 60 * 1000; // 2 hours
  
  if (currentTime - parseInt(loginTime) > sessionDuration) {
    console.log('Session expired');
    sessionStorage.clear();
    alert('Session expired! Please login again.');
    window.location.href = '/login';
    return false;
  }
  
  console.log('Authentication successful');
  return true;
}

// üî¥ IMMEDIATE AUTH CHECK
if (!checkAuthentication()) {
  // Stop execution if not authenticated
  throw new Error('Authentication failed - redirecting to login');
}
    // =======================================================
    // ‡ßß. ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
    // =======================================================
    const firebaseConfig = {
      apiKey: "AIzaSyCUGkcHFSYVmA0KUSRHhY-ZFFAS6jpJe4M",
      authDomain: "doctor-appointment-syste-23828.firebaseapp.com",
      projectId: "doctor-appointment-syste-23828",
      storageBucket: "doctor-appointment-syste-23828.appspot.com",
      messagingSenderId: "79600391014",
      appId: "1:79600391014:web:9688db8bb62f431ae16ea7"
    };

    let db;
    let allAppointmentsSnapshot = null;
    let serialRanges = {};
    let appointments = [];
    let pendingSelections = {};
    let adminSessionId = 'admin_' + Date.now();
    let currentFilters = {
      day: 'all',
      type: 'all',
      time: 'all',
      callStatus: 'all',
      tokenStatus: 'all',
      search: ''
    };
    
    // Grid System Instance
    let gridSystem = null;
    
    try {
      const app = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore(app);
      console.log("‚úÖ Firebase initialized");
    } catch (e) {
      console.error("‚ùå Firebase initialization error:", e);
    }

    // =======================================================
    // ‡ß®. DOM ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶®
    // =======================================================
    const elements = {
      loadingMessage: document.getElementById('loadingMessage'),
      appointmentsTable: document.getElementById('appointmentsTable'),
      appointmentsBody: document.getElementById('appointmentsBody'),
      statusMessage: document.getElementById('statusMessage'),
      filteredCount: document.getElementById('filteredCount'),
      displayedCount: document.getElementById('displayedCount'),
      
      // ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
      dayFilter: document.getElementById('dayFilterSerial'),
      typeFilter: document.getElementById('typeFilterSerial'),
      timeFilter: document.getElementById('timeFilterSerial'),
      callStatusFilter: document.getElementById('call-status-filter'),
      tokenStatusFilter: document.getElementById('token-status-filter'),
      searchInput: document.getElementById('searchInput'),
      
      // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
      dayFilterMobile: document.getElementById('dayFilterSerialMobile'),
      typeFilterMobile: document.getElementById('typeFilterSerialMobile'),
      timeFilterMobile: document.getElementById('timeFilterSerialMobile'),
      callStatusFilterMobile: document.getElementById('call-status-filter-mobile'),
      tokenStatusFilterMobile: document.getElementById('token-status-filter-mobile'),
      searchInputMobile: document.getElementById('searchInputMobile'),
      
      // ‡¶ï‡¶æ‡¶∞‡ßç‡¶°
      calledCount: document.getElementById('called-count'),
      notCalledCount: document.getElementById('not-called-count'),
      tokenGivenCount: document.getElementById('token-given-count'),
      tokenNotGivenCount: document.getElementById('token-not-given-count'),
      thursdayAppointments: document.getElementById('thursdayAppointments'),
      fridayAppointments: document.getElementById('fridayAppointments'),
      totalAppointments: document.getElementById('totalAppointments'),
      pendingSerials: document.getElementById('pendingSerials'),
      totalSerials: document.getElementById('totalSerials'),
      availableSerials: document.getElementById('availableSerials'),
      newPatientLastCall: document.getElementById('newPatientLastCall'),
      oldPatientLastCall: document.getElementById('oldPatientLastCall'),
      
      // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤
      quickSerialModal: document.getElementById('quickSerialModal'),
      closeQuickModal: document.getElementById('closeQuickModal'),
      cancelQuickModal: document.getElementById('cancelQuickModal'),
      openAddSerialModalBtn: document.getElementById('openAddSerialModalBtn'),
      openAddSerialModalBtnMobile: document.getElementById('openAddSerialModalBtnMobile'),
      quickSerialForm: document.getElementById('quickSerialForm'),
      quickDay: document.getElementById('quickDay'),
      quickTime: document.getElementById('quickTime'),
      serialGrid: document.getElementById('serialGrid'),
      selectedPatientType: document.getElementById('selectedPatientType'),
      serialInput: document.getElementById('serialInput'),
      quickName: document.getElementById('quickName'),
      quickAgeYears: document.getElementById('quickAgeYears'),
      quickAgeMonths: document.getElementById('quickAgeMonths'),
      quickAgeDays: document.getElementById('quickAgeDays'),
      quickPhone: document.getElementById('quickPhone'),
      submitQuickBtn: document.getElementById('submitQuickBtn')
    };

    // =======================================================
    // ‡ß©. ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (showAlert ‡¶∏‡¶π)
    // =======================================================
    const toBengaliNumber = (num) => {
      if (num === null || num === undefined || num === '‚Äî') return '‚Äî';
      const numStr = String(num); 
      const bengaliMap = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'];
      return numStr.replace(/\d/g, digit => bengaliMap[digit]);
    };

    const formatTimestamp = (timestamp) => {
      if (!timestamp || !timestamp.toDate) return '‚Äî';
      const date = timestamp.toDate();
      return date.toLocaleString('bn-BD', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      }).replace(/\d/g, toBengaliNumber);
    };
    
    const getAgeDisplay = (data) => {
      let ageDisplay = '';
      
      if (data.ageYears || data.ageMonths || data.ageDays) {
        const years = data.ageYears || 0;
        const months = data.ageMonths || 0;
        const days = data.ageDays || 0;
        
        if (years > 0) ageDisplay += `${toBengaliNumber(years)} ‡¶¨‡¶õ‡¶∞`;
        if (months > 0) {
          if (ageDisplay) ageDisplay += ', ';
          ageDisplay += `${toBengaliNumber(months)} ‡¶Æ‡¶æ‡¶∏`;
        }
        if (days > 0) {
          if (ageDisplay) ageDisplay += ', ';
          ageDisplay += `${toBengaliNumber(days)} ‡¶¶‡¶ø‡¶®`;
        }
      } else if (data.age) {
        if (typeof data.age === 'number' && data.age > 0) {
          ageDisplay = `${toBengaliNumber(data.age)} ‡¶¨‡¶õ‡¶∞`;
        } else if (typeof data.age === 'string') {
          ageDisplay = data.age;
        }
      }
      
      return ageDisplay || '‚Äî';
    };

    // demo.html ‡¶è‡¶∞ ‡¶Æ‡¶§ showAlert ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    const showAlert = (message, type = 'info') => {
      const alert = document.createElement('div');
      alert.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        padding: 16px 24px;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        z-index: 3000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
        font-family: 'Noto Sans Bengali', sans-serif;
      `;
      
      if (type === 'success') {
        alert.style.background = 'linear-gradient(135deg, #10b981, #059669)';
      } else if (type === 'error') {
        alert.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
      } else if (type === 'warning') {
        alert.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
      } else {
        alert.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
      }
      
      alert.textContent = message;
      document.body.appendChild(alert);
      
      setTimeout(() => {
        alert.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => alert.remove(), 300);
      }, 3000);
    };

    // CSS ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó (‡¶Ø‡¶¶‡¶ø ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá)
    if (!document.querySelector('style[data-alert-animation]')) {
      const style = document.createElement('style');
      style.setAttribute('data-alert-animation', 'true');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    }

    // ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    const sortTimes = (times) => {
      return times.sort((a, b) => {
        const convertTo24Hour = (timeStr) => {
          if (!timeStr) return 0;
          const time = timeStr.toUpperCase().trim();
          let [timePart, modifier] = time.split(' ');
          
          if (!modifier) {
            modifier = time.includes('PM') ? 'PM' : time.includes('AM') ? 'AM' : '';
            if (modifier) {
              timePart = time.replace(modifier, '').trim();
            }
          }
          
          const [hours, minutes] = timePart.split(':').map(Number);
          
          let hour24 = hours || 0;
          
          if (modifier === 'PM' && hour24 !== 12) {
            hour24 += 12;
          } else if (modifier === 'AM' && hour24 === 12) {
            hour24 = 0;
          }
          
          return hour24 * 100 + (minutes || 0);
        };
        
        const aMinutes = convertTo24Hour(a);
        const bMinutes = convertTo24Hour(b);
        
        return aMinutes - bMinutes;
      });
    };

    // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ö‡ßá‡¶ï
    function isExpiredAppointment(data) {
      if (!data.timestamp || !data.timestamp.toDate) return false;
      
      const appointmentDate = data.timestamp.toDate();
      const fourDaysAgo = new Date();
      fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);
      
      return appointmentDate < fourDaysAgo;
    }

    // =======================================================
    // ‡ß™. ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü - UPDATED
    // =======================================================
    function updateDashboardCards(snapshot) {
      if (!snapshot) return;
      
      // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ó‡¶£‡¶®‡¶æ (‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
      const fourDaysAgo = new Date();
      fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);
      
      let total = 0;
      let thursday = 0;
      let friday = 0;
      let called = 0;
      let notCalled = 0;
      let tokenGiven = 0;
      let tokenNotGiven = 0;
      let newPatientLastCallSerial = 0;
      let oldPatientLastCallSerial = 0;
      
      // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶®/‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶≤ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨‡¶ø‡¶§ ‡¶π‡¶¨‡ßá
      const dayFilter = currentFilters.day;
      
      // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó
      snapshot.forEach(doc => {
        const data = doc.data();
        
        // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ö‡ßá‡¶ï
        if (data.timestamp && data.timestamp.toDate) {
          const appointmentDate = data.timestamp.toDate();
          if (appointmentDate < fourDaysAgo) {
            // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶§‡ßÅ‡¶®/‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
            // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ó‡¶£‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶ï‡¶ø‡¶™
          } else {
            // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ - ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
            // ‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó
            const dayMatch = currentFilters.day === 'all' || data.day === currentFilters.day;
            const typeMatch = currentFilters.type === 'all' || (data.patientType || data.type) === currentFilters.type;
            const timeMatch = currentFilters.time === 'all' || data.time === currentFilters.time;
            const callStatusMatch = currentFilters.callStatus === 'all' || 
              (currentFilters.callStatus === 'called' && data.called === true) ||
              (currentFilters.callStatus === 'not_called' && data.called !== true);
            const tokenStatusMatch = currentFilters.tokenStatus === 'all' || 
              (currentFilters.tokenStatus === 'given' && data.tokenGiven === true) ||
              (currentFilters.tokenStatus === 'not_given' && data.tokenGiven !== true);
            const searchMatch = !currentFilters.search || 
              (data.name && data.name.toLowerCase().includes(currentFilters.search)) ||
              (data.phone && data.phone.includes(currentFilters.search)) ||
              (data.serial && data.serial.toString().includes(currentFilters.search));
            
            if (dayMatch && typeMatch && timeMatch && callStatusMatch && tokenStatusMatch && searchMatch) {
              total++;
              
              // ‡¶¶‡¶ø‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ
              if (data.day === 'Thursday') thursday++;
              if (data.day === 'Friday') friday++;
              
              // ‡¶ï‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏
              if (data.called === true) called++;
              else notCalled++;
              
              // ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏
              if (data.tokenGiven === true) tokenGiven++;
              else tokenNotGiven++;
            }
          }
        }
        
        // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶®/‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶≤ - ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨‡¶ø‡¶§
        if (data.called === true) {
          const type = data.patientType || data.type || 'new';
          
          // ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï
          const isDayMatch = dayFilter === 'all' || data.day === dayFilter;
          
          if (isDayMatch) {
            if (type === 'new') {
              newPatientLastCallSerial = Math.max(newPatientLastCallSerial, data.serial || 0);
            } else {
              oldPatientLastCallSerial = Math.max(oldPatientLastCallSerial, data.serial || 0);
            }
          }
        }
      });
      
      // ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
      elements.calledCount.textContent = toBengaliNumber(called);
      elements.notCalledCount.textContent = toBengaliNumber(notCalled);
      elements.tokenGivenCount.textContent = toBengaliNumber(tokenGiven);
      elements.tokenNotGivenCount.textContent = toBengaliNumber(tokenNotGiven);
      elements.thursdayAppointments.textContent = toBengaliNumber(thursday);
      elements.fridayAppointments.textContent = toBengaliNumber(friday);
      elements.totalAppointments.textContent = toBengaliNumber(total);
      
      // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶®/‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶® ‡¶∞‡ßã‡¶ó‡ßÄ ‡¶≤‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶≤ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° - ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨‡¶ø‡¶§
      elements.newPatientLastCall.textContent = toBengaliNumber(newPatientLastCallSerial);
      elements.oldPatientLastCall.textContent = toBengaliNumber(oldPatientLastCallSerial);
      
      // ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü - ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ
      updateSerialStats();
    }

    // =======================================================
    // ‡ß´. ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶∂‡¶® (‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨‡¶ø‡¶§)
    // =======================================================
    async function updateSerialStats() {
      try {
        // ‡¶≤‡ßã‡¶° ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡ßá‡¶û‡ßç‡¶ú
        await loadSerialRanges();
        
        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏
        let totalSerialCount = 0;
        
        // ‚úÖ ‡¶Æ‡ßã‡¶ü ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶≤‡¶ü - ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø (‡¶Ø‡¶¶‡¶ø 'all' ‡¶®‡¶Ø‡¶º)
        const selectedDay = currentFilters.day;
        
        if (selectedDay === 'all') {
          // ‡¶∏‡¶¨ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶≤‡¶ü ‡¶ó‡¶£‡¶®‡¶æ
          for (const day in serialRanges) {
            for (const type in serialRanges[day]) {
              for (const time in serialRanges[day][type]) {
                const [start, end] = serialRanges[day][type][time];
                totalSerialCount += (end - start + 1);
              }
            }
          }
        } else {
          // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶≤‡¶ü ‡¶ó‡¶£‡¶®‡¶æ
          if (serialRanges[selectedDay]) {
            for (const type in serialRanges[selectedDay]) {
              for (const time in serialRanges[selectedDay][type]) {
                const [start, end] = serialRanges[selectedDay][type][time];
                totalSerialCount += (end - start + 1);
              }
            }
          }
        }
        
        // ‚úÖ ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç ‡¶ó‡¶£‡¶®‡¶æ (‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã)
        const fourDaysAgo = new Date();
        fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);
        
        let activeBookings = 0;
        let totalBookings = 0;
        if (allAppointmentsSnapshot) {
          allAppointmentsSnapshot.forEach(doc => {
            const data = doc.data();
            totalBookings++;
            
            // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ
            if (data.timestamp && data.timestamp.toDate) {
              const appointmentDate = data.timestamp.toDate();
              if (appointmentDate >= fourDaysAgo) {
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç (‡¶Ø‡¶¶‡¶ø 'all' ‡¶®‡¶Ø‡¶º)
                if (selectedDay === 'all' || data.day === selectedDay) {
                  activeBookings++;
                }
              }
            }
          });
        }
        
        // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü - ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        let pendingCount = 0;
        for (const key in pendingSelections) {
          if (pendingSelections[key]) {
            // ‡¶¶‡¶ø‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï
            const dayFromKey = key.split('_')[0];
            if (selectedDay === 'all' || dayFromKey === selectedDay) {
              pendingCount += pendingSelections[key].user.length;
            }
          }
        }
        
        // ‡¶è‡¶≠‡ßá‡¶á‡¶≤‡ßá‡¶¨‡¶≤ = ‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶≤‡¶ü - ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç - ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç
        const availableSerials = Math.max(0, totalSerialCount - activeBookings - pendingCount);
        
        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°
        elements.totalSerials.textContent = toBengaliNumber(totalSerialCount);
        elements.availableSerials.textContent = toBengaliNumber(availableSerials);
        elements.pendingSerials.textContent = toBengaliNumber(pendingCount);
        
      } catch (error) {
        console.error('‚ùå Error updating serial stats:', error);
        showAlert('‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
      }
    }

    // =======================================================
    // ‡ß¨. ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    // =======================================================
    function updateTimeOptions() {
      const selectedDay = currentFilters.day;
      const selectedType = currentFilters.type;
      const uniqueTimes = new Set();
      
      if (!allAppointmentsSnapshot) return;
      
      // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
      const fourDaysAgo = new Date();
      fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);
      
      allAppointmentsSnapshot.forEach(doc => {
        const data = doc.data();
        
        // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ö‡ßá‡¶ï
        if (data.timestamp && data.timestamp.toDate) {
          const appointmentDate = data.timestamp.toDate();
          if (appointmentDate < fourDaysAgo) {
            return;
          }
        }
        
        const dayMatch = selectedDay === 'all' || data.day === selectedDay;
        const typeMatch = selectedType === 'all' || (data.patientType || data.type) === selectedType;
        
        if (dayMatch && typeMatch && data.time) {
          uniqueTimes.add(data.time);
        }
      });
      
      // ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
      const sortedTimes = sortTimes(Array.from(uniqueTimes));
      
      const currentTime = elements.timeFilter.value;
      elements.timeFilter.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º</option>';
      
      sortedTimes.forEach(time => {
        const option = document.createElement('option');
        option.value = time;
        option.textContent = time;
        if (time === currentTime) option.selected = true;
        elements.timeFilter.appendChild(option);
      });
      
      // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡¶ì ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
      if (elements.timeFilterMobile) {
        elements.timeFilterMobile.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º</option>';
        sortedTimes.forEach(time => {
          const option = document.createElement('option');
          option.value = time;
          option.textContent = time;
          if (time === currentTime) option.selected = true;
          elements.timeFilterMobile.appendChild(option);
        });
      }
    }

    // =======================================================
    // ‡ß≠. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ)
    // =======================================================
    function renderAppointments() {
      if (!allAppointmentsSnapshot) return;
      
      elements.appointmentsBody.innerHTML = '';
      elements.loadingMessage.style.display = 'none';
      elements.appointmentsTable.style.display = 'table';
      
      // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∂‡ßá‡¶∑ ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
      const fourDaysAgo = new Date();
      fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);
      
      let filteredDocs = [];
      let filteredCount = 0;
      let displayedCount = 0;
      
      // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó
      allAppointmentsSnapshot.forEach(doc => {
        const data = doc.data();
        let isMatch = true;
        
        // ‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
        if (data.timestamp && data.timestamp.toDate) {
          const appointmentDate = data.timestamp.toDate();
          if (appointmentDate < fourDaysAgo) {
            isMatch = false;
          }
        }
        
        // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó
        if (isMatch && currentFilters.day !== 'all' && data.day !== currentFilters.day) isMatch = false;
        if (isMatch && currentFilters.type !== 'all') {
          const type = data.patientType || data.type;
          if (type !== currentFilters.type) isMatch = false;
        }
        if (isMatch && currentFilters.time !== 'all' && data.time !== currentFilters.time) isMatch = false;
        if (isMatch && currentFilters.callStatus !== 'all') {
          const isCalled = data.called === true;
          if ((currentFilters.callStatus === 'called' && !isCalled) ||
              (currentFilters.callStatus === 'not_called' && isCalled)) {
            isMatch = false;
          }
        }
        if (isMatch && currentFilters.tokenStatus !== 'all') {
          const isTokenGiven = data.tokenGiven === true;
          if ((currentFilters.tokenStatus === 'given' && !isTokenGiven) ||
              (currentFilters.tokenStatus === 'not_given' && isTokenGiven)) {
            isMatch = false;
          }
        }
        if (isMatch && currentFilters.search) {
          const name = (data.name || '').toLowerCase();
          const phone = String(data.phone || '');
          const serial = String(data.serial || '');
          
          if (!name.includes(currentFilters.search) && 
              !phone.includes(currentFilters.search) && 
              !serial.includes(currentFilters.search)) {
            isMatch = false;
          }
        }
        
        if (isMatch) {
          filteredCount++;
          filteredDocs.push({ id: doc.id, data: data });
          displayedCount++;
        }
      });
      
      // ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
      elements.filteredCount.textContent = toBengaliNumber(filteredCount);
      elements.displayedCount.textContent = toBengaliNumber(displayedCount);
      
      if (filteredDocs.length === 0) {
        elements.appointmentsBody.innerHTML = `
          <tr>
            <td colspan="11" style="text-align: center; padding: 40px; color: var(--gray);">
              ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø
            </td>
          </tr>
        `;
        return;
      }
      
      // ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶æ‡¶∞‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
      filteredDocs.sort((a, b) => (a.data.serial || 0) - (b.data.serial || 0));
      
      // ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶∞‡ßã ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
      filteredDocs.forEach(item => {
        const { id, data } = item;
        const row = elements.appointmentsBody.insertRow();
        
        // ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏
        const isCalled = data.called === true;
        const callStatusClass = isCalled ? 'status-called' : 'status-not-called';
        const callStatusText = isCalled ? '‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
        const callButtonClass = isCalled ? 'btn-call-undo' : 'btn-call';
        const callButtonText = isCalled ? '‡¶ï‡¶≤ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤' : data.name || '‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®';
        
        const isTokenGiven = data.tokenGiven === true;
        const tokenStatusClass = isTokenGiven ? 'status-token-given' : 'status-token-not-given';
        const tokenStatusText = isTokenGiven ? '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ' : '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø';
        const tokenButtonClass = isTokenGiven ? 'btn-token-undo' : 'btn-token';
        const tokenButtonText = isTokenGiven ? '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤' : data.name || '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡¶ø‡¶®';
        
        const ageDisplay = getAgeDisplay(data);
        const typeText = (data.patientType || data.type) === 'old' ? '‡¶™‡ßÅ‡¶∞‡¶æ‡¶§‡¶®' : '‡¶®‡¶§‡ßÅ‡¶®';
        
        row.innerHTML = `
          <td>${toBengaliNumber(data.serial || '‚Äî')}</td>
          <td><span class="status-badge ${callStatusClass}">${callStatusText}</span></td>
          <td><span class="status-badge ${tokenStatusClass}">${tokenStatusText}</span></td>
          <td>${data.name || '‚Äî'}</td>
          <td>${ageDisplay}</td>
          <td style="text-align: center;">${data.phone ? toBengaliNumber(data.phone) : '‚Äî'}</td>
          <td>${data.day || '‚Äî'}, ${data.time || '‚Äî'}</td>
          <td>${typeText}</td>
          <td>${formatTimestamp(data.timestamp)}</td>
          <td><button class="action-btn ${callButtonClass}" data-id="${id}" data-field="called" data-status="${isCalled}">${callButtonText}</button></td>
          <td><button class="action-btn ${tokenButtonClass}" data-id="${id}" data-field="tokenGiven" data-status="${isTokenGiven}">${tokenButtonText}</button></td>
        `;
        
        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        row.querySelectorAll('.action-btn').forEach(btn => {
          btn.addEventListener('click', () => updateStatus(btn));
        });
      });
    }

   // =======================================================
// ‡ßÆ. ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü - FINAL SIMPLE VERSION
// =======================================================
async function updateStatus(button) {
  if (!db) return;
  
  const docId = button.getAttribute('data-id');
  const field = button.getAttribute('data-field');
  const currentStatus = button.getAttribute('data-status') === 'true';
  const newStatus = !currentStatus;
  
  // ‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶∏‡¶æ‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá)
  const row = button.closest('tr');
  const patientNameCell = row.querySelector('td:nth-child(4)');
  const patientName = patientNameCell ? patientNameCell.textContent : '';
  
  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ü‡¶® ‡¶á‡¶®‡¶´‡ßã
  const messages = {
    called: {
      true: { 
        success: `${patientName} - ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 
        button: '‡¶ï‡¶≤ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤', 
        class: 'btn-call-undo' 
      },
      false: { 
        success: `${patientName} - ‡¶ï‡¶≤ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 
        button: patientName || '‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®', 
        class: 'btn-call' 
      }
    },
    tokenGiven: {
      true: { 
        success: `${patientName} - ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`,
        button: '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤', 
        class: 'btn-token-undo' 
      },
      false: { 
        success: `${patientName} -  ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`,
        button: '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡¶ø‡¶®', 
        class: 'btn-token' 
      }
    }
  };
  
  const fieldInfo = messages[field];
  const messageInfo = fieldInfo[newStatus];
  
  if (!messageInfo) {
    showAlert('‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
    return;
  }
  
  const originalText = button.textContent;
  button.textContent = '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
  button.disabled = true;
  
  try {
    await db.collection('appointments').doc(docId).update({
      [field]: newStatus,
      [`${field}Timestamp`]: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    // ‡¶∏‡¶´‡¶≤ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
    showAlert(messageInfo.success, 'success');
    
    // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    button.textContent = messageInfo.button;
    button.className = `action-btn ${messageInfo.class}`;
    button.setAttribute('data-status', newStatus);
    button.disabled = false;
    
    // ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    if (field === 'called') {
      const statusBadge = row.querySelector('td:nth-child(2) .status-badge');
      if (statusBadge) {
        statusBadge.textContent = newStatus ? '‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
        statusBadge.className = newStatus ? 'status-badge status-called' : 'status-badge status-not-called';
      }
    } else if (field === 'tokenGiven') {
      const statusBadge = row.querySelector('td:nth-child(3) .status-badge');
      if (statusBadge) {
        statusBadge.textContent = newStatus ? '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø';
        statusBadge.className = newStatus ? 'status-badge status-token-given' : 'status-badge status-token-not-given';
      }
    }
    
  } catch (error) {
    console.error(`‚ùå Error updating ${field}:`, error);
    
    // ‡¶á‡¶∞‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
    const errorMessages = {
      called: newStatus ? '‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶ï‡¶≤ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
      tokenGiven: newStatus ? '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : '‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'
    };
    
    showAlert(errorMessages[field] || '‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
    button.textContent = originalText;
    button.disabled = false;
  }
}
    // =======================================================
    // ‡ßØ. ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü (grid.js ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá)
    // =======================================================
    
    // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: serialRanges ‡¶≤‡ßã‡¶°
    async function loadSerialRanges() {
      try {
        console.log("üìä Loading serial ranges from Firebase...");
        const rangesDoc = await db.collection('settings').doc('serialRanges').get();
        
        if (rangesDoc.exists) {
          serialRanges = rangesDoc.data();
          console.log("‚úÖ Serial ranges loaded successfully");
          return serialRanges;
        } else {
          console.warn("‚ö†Ô∏è No serial ranges found in database");
          serialRanges = {
            Thursday: { new: {}, old: {} },
            Friday: { new: {}, old: {} }
          };
          return serialRanges;
        }
      } catch (error) {
        console.error("‚ùå Error loading serial ranges:", error);
        return null;
      }
    }
    
    function initializeQuickSerialModal() {
      console.log("üü¢ initializeQuickSerialModal ‡¶ï‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
      
      // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ - ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™
      elements.openAddSerialModalBtn.addEventListener('click', async () => {
        console.log("üü¢ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        
        elements.quickSerialModal.style.display = 'flex';
        console.log("üü¢ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ display: flex ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        
        // ‚úÖ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá serialRanges ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        console.log("üîÑ Loading serial ranges before grid initialization");
        await loadSerialRanges();
        
        try {
          await initializeGridSystem();
          console.log("‚úÖ initializeGridSystem ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        } catch (error) {
          console.error("‚ùå initializeGridSystem ‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:", error);
          showAlert('‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        }
      });
      
      // ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ - ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤
      if (elements.openAddSerialModalBtnMobile) {
        elements.openAddSerialModalBtnMobile.addEventListener('click', async () => {
          console.log("üü¢ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
          
          elements.quickSerialModal.style.display = 'flex';
          console.log("üü¢ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ display: flex ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
          
          // ‚úÖ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá serialRanges ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
          console.log("üîÑ Loading serial ranges before grid initialization");
          await loadSerialRanges();
          
          try {
            await initializeGridSystem();
            console.log("‚úÖ initializeGridSystem ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá");
          } catch (error) {
            console.error("‚ùå initializeGridSystem ‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:", error);
            showAlert('‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
          }
        });
      }
      
      elements.closeQuickModal.addEventListener('click', () => {
        console.log("üî¥ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï");
        elements.quickSerialModal.style.display = 'none';
        resetQuickSerialForm();
        
        // Grid System ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
        if (gridSystem) {
          try {
            gridSystem.cleanup();
          } catch (e) {
            console.warn("‚ö†Ô∏è ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", e);
          }
          gridSystem = null;
        }
      });
      
      elements.cancelQuickModal.addEventListener('click', () => {
        console.log("üî¥ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡ßá‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï");
        elements.quickSerialModal.style.display = 'none';
        resetQuickSerialForm();
        
        // Grid System ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
        if (gridSystem) {
          try {
            gridSystem.cleanup();
          } catch (e) {
            console.warn("‚ö†Ô∏è ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", e);
          }
          gridSystem = null;
        }
      });
      
      // ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
      elements.quickDay.addEventListener('change', () => {
        console.log("üìÖ Quick day changed:", elements.quickDay.value);
        updateQuickTimeOptions();
      });
      
      // ‡¶∏‡¶Æ‡ßü ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
      elements.quickTime.addEventListener('change', () => {
        console.log("üïí Quick time changed:", elements.quickTime.value);
        
        // Grid System ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        if (gridSystem) {
          setTimeout(() => {
            gridSystem.updateGrid();
          }, 100);
        }
      });
      
      // ‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶®
      document.querySelectorAll('.serial-type-card').forEach(card => {
        card.addEventListener('click', function() {
          console.log("üë• Patient type clicked:", this.getAttribute('data-type'));
          
          document.querySelectorAll('.serial-type-card').forEach(c => {
            c.classList.remove('selected');
          });
          this.classList.add('selected');
          elements.selectedPatientType.value = this.getAttribute('data-type');
          
          updateQuickTimeOptions();
          
          // Grid System ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          if (gridSystem) {
            setTimeout(() => {
              gridSystem.updateGrid();
            }, 100);
          }
        });
      });
      
      // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü
      elements.quickSerialForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        console.log("üì§ Quick serial form submitted");
        await addQuickSerial();
      });
    }
    
    async function initializeGridSystem() {
      console.log("üöÄ initializeGridSystem ‡¶∂‡ßÅ‡¶∞‡ßÅ...");
      
      if (!db) {
        console.error("‚ùå Firebase DB ‡¶®‡ßá‡¶á");
        showAlert('Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'error');
        return;
      }
      
      // DOM ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶® ‡¶ö‡ßá‡¶ï
      if (!elements.serialGrid) {
        console.error("‚ùå serialGrid ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø");
        console.log("serialGrid element:", document.getElementById('serialGrid'));
        return;
      }
      
      console.log("‚úÖ DOM ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá:", {
        serialGrid: elements.serialGrid,
        quickDay: elements.quickDay.value,
        quickTime: elements.quickTime.value,
        selectedPatientType: elements.selectedPatientType.value
      });
      
      // ‚úÖ Grid ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™ (‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶•‡¶æ‡¶ï‡ßá)
      if (gridSystem) {
        console.log("üßπ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã Grid System ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá");
        try {
          gridSystem.cleanup();
        } catch (e) {
          console.warn("‚ö†Ô∏è ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", e);
        }
        gridSystem = null;
      }
      
      try {
        // ‚úÖ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        elements.serialGrid.innerHTML = '<div style="padding: 20px; text-align: center; color: #3b82f6;">‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';
        
        // ‚úÖ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá serialRanges ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        if (Object.keys(serialRanges).length === 0) {
          console.log("üîÑ serialRanges ‡¶ñ‡¶æ‡¶≤‡¶ø, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
          await loadSerialRanges();
        }
        
        console.log("‚úÖ serialRanges ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá:", serialRanges);
        
        // ‚úÖ Grid System ‡¶§‡ßà‡¶∞‡¶ø
        gridSystem = new RealTimeGridSystem({
          db: db,
          gridContainerId: 'serialGrid',
          selectedSerialInputId: 'serialInput',
          dayElementId: 'quickDay',
          timeElementId: 'quickTime',
          typeElementId: 'selectedPatientType',
          mode: 'admin',
          adminSessionId: adminSessionId,
          adminPendingExpiry: 2 * 60 * 1000, // 2 minutes
          
          onSerialClick: function(data) {
            console.log('Serial clicked:', data);
            if (data.status === 'pending') {
              console.log(`Serial ${data.serial} selected for admin`);
            }
          },
          
          onGridUpdate: function(type, data) {
            console.log(`Grid updated: ${type}`, data);
            
            if (type === 'grid') {
              console.log("‚úÖ Grid successfully rendered");
            }
          },
          
          onPendingUpdate: function(pendingData) {
            console.log('Pending selections updated:', pendingData);
          }
        });
        
        console.log("‚úÖ Grid System ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá, init ‡¶ï‡¶≤ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        
        // Grid ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
        const success = await gridSystem.init();
        
        if (success) {
          console.log("‚úÖ Grid System ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶π‡ßü‡ßá‡¶õ‡ßá");
          
          // ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          updateQuickTimeOptions();
          
          // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          setTimeout(() => {
            if (gridSystem) {
              gridSystem.updateGrid();
              console.log("‚úÖ Grid update complete");
            }
          }, 100);
          
        } else {
          console.error("‚ùå Grid System ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•");
          elements.serialGrid.innerHTML = '<div style="padding: 20px; text-align: center; color: #dc2626;">‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</div>';
          showAlert('‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        }
        
      } catch (error) {
        console.error("‚ùå Grid System ‡¶§‡ßà‡¶∞‡¶ø/‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:", error);
        console.error("Error details:", error.stack);
        
        elements.serialGrid.innerHTML = `
          <div style="padding: 20px; text-align: center; color: #dc2626;">
            <strong>‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:</strong><br>
            ${error.message}
            <br><br>
            <button onclick="location.reload()" style="padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px;">
              ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
          </div>
        `;
        
        showAlert('‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
      }
    }
    
    function updateQuickTimeOptions() {
      const day = elements.quickDay.value;
      const type = elements.selectedPatientType.value;
      
      console.log("üïí Quick time options update:", { day, type });
      console.log("Serial Ranges available:", serialRanges);
      
      if (!day) {
        elements.quickTime.innerHTML = '<option value="">‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
        if (elements.serialGrid) {
          elements.serialGrid.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">‡¶¶‡¶ø‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>';
        }
        return;
      }
      
      // ‚úÖ ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡ßá‡¶û‡ßç‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶™‡¶∂‡¶® ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
      const times = [];
      
      console.log("Checking serialRanges for:", {day, type});
      console.log("serialRanges[day]:", serialRanges[day]);
      console.log("serialRanges[day][type]:", serialRanges[day] ? serialRanges[day][type] : "undefined");
      
      if (serialRanges[day] && serialRanges[day][type]) {
        Object.keys(serialRanges[day][type]).forEach(time => {
          if (time && time.trim() !== '') {
            times.push(time);
          }
        });
        console.log("‚úÖ Found times in serialRanges:", times);
      } else {
        console.warn("‚ùå No serial ranges found for", day, type);
        console.log("Available days in serialRanges:", Object.keys(serialRanges));
        console.log("Available types for", day, ":", serialRanges[day] ? Object.keys(serialRanges[day]) : "none");
      }
      
      // ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
      const sortedTimes = sortTimes(times);
      
      const currentSelectedTime = elements.quickTime.value;
      elements.quickTime.innerHTML = '<option value="">‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
      
      if (sortedTimes.length === 0) {
        console.warn("‚ö†Ô∏è No time slots found for", day, type);
        elements.quickTime.innerHTML = '<option value="">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡ßç‡¶≤‡¶ü ‡¶®‡ßá‡¶á</option>';
        
        if (gridSystem) {
          gridSystem.updateGrid();
        }
        
        // ‡¶ó‡ßç‡¶∞‡¶ø‡¶°‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        if (elements.serialGrid) {
          elements.serialGrid.innerHTML =  '<div class="grid-no-selection">‡¶è‡¶á ‡¶¶‡¶ø‡¶®/‡¶ß‡¶∞‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡ßç‡¶≤‡¶ü ‡¶®‡ßá‡¶á</div>';
        }
        return;
      }
      
      sortedTimes.forEach(time => {
        const option = document.createElement('option');
        option.value = time;
        option.textContent = time;
        
        // ‡¶Ü‡¶ó‡ßá ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶æ
        if (time === currentSelectedTime) {
          option.selected = true;
        }
        
        elements.quickTime.appendChild(option);
      });
      
      console.log("‚úÖ Time options updated:", sortedTimes.length, "options");
      
      // ‚úÖ Grid System ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
      if (gridSystem) {
        console.log("üîÑ Updating grid with new time selection");
        setTimeout(() => {
          gridSystem.updateGrid();
        }, 100);
      }
    }
    
    async function addQuickSerial() {
      if (!db) {
        showAlert('Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'error');
        return;
      }
      
      const name = elements.quickName.value.trim();
      const day = elements.quickDay.value;
      const time = elements.quickTime.value;
      const type = elements.selectedPatientType.value;
      const serial = parseInt(elements.serialInput.value);
      const years = parseInt(elements.quickAgeYears.value) || 0;
      const months = parseInt(elements.quickAgeMonths.value) || 0;
      const days = parseInt(elements.quickAgeDays.value) || 0;
      const phone = elements.quickPhone.value.trim();
      
      // ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
      if (!name) {
        showAlert('‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®', 'error');
        return;
      }
      
      if (!day || !time) {
        showAlert('‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
        return;
      }
      
      if (!serial) {
        showAlert('‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
        return;
      }
      
      if (years === 0 && months === 0 && days === 0) {
        showAlert('‡¶¨‡¶Ø‡¶º‡¶∏ ‡¶¶‡¶ø‡¶®', 'error');
        return;
      }
      
      // ‡¶ö‡ßá‡¶ï ‡ßß: ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶¨‡ßÅ‡¶ï‡¶ø‡¶Ç (‡ß™ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã) ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ
      const fourDaysAgo = new Date();
      fourDaysAgo.setDate(fourDaysAgo.getDate() - 4);
      
      const activeAppointment = appointments.find(app => {
        const patientType = app.patientType || app.type;
        if (app.day === day && 
            app.time === time && 
            patientType === type &&
            app.serial === serial) {
          
          if (app.timestamp && app.timestamp.toDate) {
            const appointmentDate = app.timestamp.toDate();
            return appointmentDate >= fourDaysAgo;
          }
          return true;
        }
        return false;
      });
      
      if (activeAppointment) {
        showAlert(`‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ #${serial} ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'error');
        return;
      }
      
      try {
        // ‡¶¨‡¶Ø‡¶º‡¶∏ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶§‡ßà‡¶∞‡¶ø
        let ageString = '';
        if (years > 0) ageString += `${years} ‡¶¨‡¶õ‡¶∞`;
        if (months > 0) {
          if (ageString) ageString += ', ';
          ageString += `${months} ‡¶Æ‡¶æ‡¶∏`;
        }
        if (days > 0) {
          if (ageString) ageString += ', ';
          ageString += `${days} ‡¶¶‡¶ø‡¶®`;
        }
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ
        const appointmentData = {
          name: name,
          age: ageString,
          ageYears: years,
          ageMonths: months,
          ageDays: days,
          phone: phone || null,
          day: day,
          time: time,
          patientType: type,
          type: type,
          serial: serial,
          called: false,
          tokenGiven: false,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡ßá‡¶ü
        const submitBtn = document.getElementById('submitQuickBtn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        submitBtn.disabled = true;

        await db.collection('appointments').add(appointmentData);
        
        // ‡¶∏‡¶´‡¶≤ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú (demo.html ‡¶è‡¶∞ ‡¶Æ‡¶§)
        showAlert(`‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ #${serial} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
        
        // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
        resetQuickSerialForm();
        elements.quickSerialModal.style.display = 'none';
        
        // Grid System ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
        if (gridSystem) {
          gridSystem.cleanup();
          gridSystem = null;
        }
        
      } catch (error) {
        console.error('‚ùå Error adding serial:', error);
        showAlert('‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
      } finally {
        // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
        const submitBtn = document.getElementById('submitQuickBtn');
        if (submitBtn) {
          submitBtn.innerHTML = '‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®';
          submitBtn.disabled = false;
        }
      }
    }
  
    function resetQuickSerialForm() {
      elements.quickSerialForm.reset();
      elements.serialInput.value = '';
      document.querySelectorAll('.serial-type-card').forEach(card => {
        card.classList.remove('selected');
      });
      document.querySelector('.serial-type-card[data-type="new"]').classList.add('selected');
      elements.selectedPatientType.value = 'new';
    }

    // =======================================================
    // ‡ßß‡ß¶. ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶â‡¶≠‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    // =======================================================
    function setupFilterListeners() {
      // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
      const handleSearch = (value) => {
        currentFilters.search = value.toLowerCase().trim();
        renderAppointments();
        updateDashboardCards(allAppointmentsSnapshot);
      };
      
      // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü
      let searchTimeout;
      
      // ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
      elements.dayFilter.addEventListener('change', (e) => {
        const value = e.target.value;
        currentFilters.day = value;
        if (elements.dayFilterMobile) elements.dayFilterMobile.value = value;
        updateTimeOptions();
        renderAppointments();
        updateDashboardCards(allAppointmentsSnapshot);
        updateSerialStats();
      });
      
      elements.typeFilter.addEventListener('change', (e) => {
        const value = e.target.value;
        currentFilters.type = value;
        if (elements.typeFilterMobile) elements.typeFilterMobile.value = value;
        updateTimeOptions();
        renderAppointments();
        updateDashboardCards(allAppointmentsSnapshot);
      });
      
      elements.timeFilter.addEventListener('change', (e) => {
        const value = e.target.value;
        currentFilters.time = value;
        if (elements.timeFilterMobile) elements.timeFilterMobile.value = value;
        renderAppointments();
        updateDashboardCards(allAppointmentsSnapshot);
      });
      
      elements.callStatusFilter.addEventListener('change', (e) => {
        const value = e.target.value;
        currentFilters.callStatus = value;
        if (elements.callStatusFilterMobile) elements.callStatusFilterMobile.value = value;
        renderAppointments();
        updateDashboardCards(allAppointmentsSnapshot);
      });
      
      elements.tokenStatusFilter.addEventListener('change', (e) => {
        const value = e.target.value;
        currentFilters.tokenStatus = value;
        if (elements.tokenStatusFilterMobile) elements.tokenStatusFilterMobile.value = value;
        renderAppointments();
        updateDashboardCards(allAppointmentsSnapshot);
      });
      
      elements.searchInput.addEventListener('input', (e) => {
        const value = e.target.value;
        if (elements.searchInputMobile) elements.searchInputMobile.value = value;
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => handleSearch(value), 300);
      });
      
      // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
      if (elements.dayFilterMobile) {
        elements.dayFilterMobile.addEventListener('change', (e) => {
          const value = e.target.value;
          currentFilters.day = value;
          elements.dayFilter.value = value;
          updateTimeOptions();
          renderAppointments();
          updateDashboardCards(allAppointmentsSnapshot);
          updateSerialStats();
        });
      }
      
      if (elements.typeFilterMobile) {
        elements.typeFilterMobile.addEventListener('change', (e) => {
          const value = e.target.value;
          currentFilters.type = value;
          elements.typeFilter.value = value;
          updateTimeOptions();
          renderAppointments();
          updateDashboardCards(allAppointmentsSnapshot);
        });
      }
      
      if (elements.timeFilterMobile) {
        elements.timeFilterMobile.addEventListener('change', (e) => {
          const value = e.target.value;
          currentFilters.time = value;
          elements.timeFilter.value = value;
          renderAppointments();
          updateDashboardCards(allAppointmentsSnapshot);
        });
      }
      
      if (elements.callStatusFilterMobile) {
        elements.callStatusFilterMobile.addEventListener('change', (e) => {
          const value = e.target.value;
          currentFilters.callStatus = value;
          elements.callStatusFilter.value = value;
          renderAppointments();
          updateDashboardCards(allAppointmentsSnapshot);
        });
      }
      
      if (elements.tokenStatusFilterMobile) {
        elements.tokenStatusFilterMobile.addEventListener('change', (e) => {
          const value = e.target.value;
          currentFilters.tokenStatus = value;
          elements.tokenStatusFilter.value = value;
          renderAppointments();
          updateDashboardCards(allAppointmentsSnapshot);
        });
      }
      
      if (elements.searchInputMobile) {
        elements.searchInputMobile.addEventListener('input', (e) => {
          const value = e.target.value;
          elements.searchInput.value = value;
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => handleSearch(value), 300);
        });
      }
    }

    // =======================================================
    // ‡ßß‡ßß. ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
    // =======================================================
    function setupRealtimeListener() {
      if (!db) {
        showAlert('Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'error');
        return;
      }
      
      // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
      const appointmentsListener = db.collection('appointments')
        .orderBy('timestamp', 'desc')
        .onSnapshot(snapshot => {
          console.log('üîÑ Appointments update:', snapshot.size, 'appointments');
          allAppointmentsSnapshot = snapshot;
          
          // appointments array ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          appointments = [];
          snapshot.forEach(doc => {
            appointments.push({
              id: doc.id,
              ...doc.data()
            });
          });
          
          // ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          updateDashboardCards(snapshot);
          
          // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          updateTimeOptions();
          
          // ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
          renderAppointments();
          
          // ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          updateSerialStats();
          
          // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶π‡¶æ‡¶á‡¶°
          elements.loadingMessage.style.display = 'none';
        }, error => {
          console.error('‚ùå Appointments listener error:', error);
          elements.loadingMessage.textContent = '‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
          showAlert('‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'error');
        });
      
      // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ (‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
      const pendingListener = db.collection('pendingSelections')
        .where('expiresAt', '>', new Date())
        .onSnapshot(snapshot => {
          console.log('üîÑ Pending selections update:', snapshot.size);
          
          // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏
          const now = new Date();
          pendingSelections = {};
          
          snapshot.forEach(doc => {
            const data = doc.data();
            if (data.expiresAt && data.expiresAt.toDate() > now) {
              const key = `${data.day}_${data.time}_${data.type}`;
              
              if (!pendingSelections[key]) {
                pendingSelections[key] = {
                  user: []
                };
              }
              
              if (data.bookedBy === 'user') {
                pendingSelections[key].user.push({
                  serial: data.serial,
                  id: doc.id,
                  expiresAt: data.expiresAt
                });
              }
            }
          });
          
          // ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
          updateSerialStats();
        }, error => {
          console.error('‚ùå Pending selections listener error:', error);
        });
      
      // ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
      return () => {
        appointmentsListener();
        pendingListener();
      };
    }

    // =======================================================
    // ‡ßß‡ß®. ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
    // =======================================================
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing...');
      
      // Firebase ‡¶ö‡ßá‡¶ï
      if (!db) {
        elements.loadingMessage.textContent = 'Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á';
        showAlert('Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'error');
        return;
      }
      
      // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∂‡ßã
      elements.loadingMessage.style.display = 'block';
      
      // ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
      setupFilterListeners();
      
      // ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶∏‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤
      initializeQuickSerialModal();
      
      // ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá serialRanges ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
      loadSerialRanges().then(() => {
        console.log("‚úÖ Initial serial ranges loaded");
      });
      
      // ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
      const cleanupListeners = setupRealtimeListener();
      
      // ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü (‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß)
      window.addEventListener('click', (event) => {
        if (event.target === elements.quickSerialModal) {
          elements.quickSerialModal.style.display = 'none';
          resetQuickSerialForm();
          
          // Grid System ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
          if (gridSystem) {
            gridSystem.cleanup();
            gridSystem = null;
          }
        }
      });
      
      // ‡¶¨‡ßá‡¶´‡ßã‡¶∞ ‡¶Ü‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
      window.addEventListener('beforeunload', () => {
        if (typeof cleanupListeners === 'function') {
          cleanupListeners();
        }
        
        if (gridSystem) {
          gridSystem.cleanup();
        }
      });
      
      console.log('Initialization complete');
    });
  </script>
</body>
</html>